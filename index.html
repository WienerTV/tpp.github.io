<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆç”¨ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸</title>
    <style>
        /* --- å…¨ä½“ã®ã‚¹ã‚¿ã‚¤ãƒ« --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; /* Safari/iOSå‘ã‘ã«ãƒ•ã‚©ãƒ³ãƒˆã‚’èª¿æ•´ */
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 {
            color: #333;
        }

        /* --- å‹•ç”»ã‚³ãƒ³ãƒ†ãƒŠé–¢é€£ --- */
        .video-container {
            position: relative;
            width: 90%;
            max-width: 800px;
            margin: 20px auto;
            border: 1px solid #ccc;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            background-color: #000;
        }

        .video-container video {
            width: 100%;
            height: auto;
            display: block;
        }

        .ad-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex; /* ä¸­å¤®é…ç½®ã®ãŸã‚ */
            justify-content: center; /* ä¸­å¤®é…ç½®ã®ãŸã‚ */
            align-items: center; /* ä¸­å¤®é…ç½®ã®ãŸã‚ */
        }

        /* --- UIè¦ç´  --- */
        #play-button {
            width: 0;
            height: 0;
            border-top: 30px solid transparent;
            border-bottom: 30px solid transparent;
            border-left: 50px solid rgba(255, 255, 255, 0.8);
            cursor: pointer;
            transition: border-left-color 0.2s ease;
            position: absolute; /* ad-overlayãŒflexã§ã‚‚ä¸­å¤®ã‚’ç¶­æŒ */
        }

        #play-button:hover {
            border-left-color: white;
        }

        #skip-button {
            position: absolute;
            bottom: 20px;
            right: 20px;
            padding: 8px 16px;
            font-size: clamp(12px, 2vw, 16px); /* ç”»é¢ã‚µã‚¤ã‚ºã«å¿œã˜ãŸãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãªæ–‡å­—ã‚µã‚¤ã‚º */
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            border: 1px solid white;
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
            display: none; /* åˆæœŸçŠ¶æ…‹ã¯éè¡¨ç¤º */
            transition: background-color 0.2s ease;
        }        
        
        #unmute-button {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            font-size: 24px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            border: 1px solid white;
            border-radius: 50%; /* å††å½¢ã« */
            cursor: pointer;
            display: flex; /* çµµæ–‡å­—ã‚’ä¸­å¤®ã«é…ç½® */
            justify-content: center;
            align-items: center;
            opacity: 0; /* æœ€åˆã¯éè¡¨ç¤º */
            transition: opacity 0.3s ease, background-color 0.2s ease;
        }

        #skip-button:hover, #unmute-button:hover {
            background-color: rgba(0, 0, 0, 0.9);
        }

        #time-display {
            text-align: center;
            margin-top: 15px;
            font-size: 16px;
            color: #555;
            height: 40px; /* 2è¡Œè¡¨ç¤ºã§ã‚‚ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãŒå´©ã‚Œãªã„ã‚ˆã†ã«é«˜ã•ã‚’ç¢ºä¿ */
            line-height: 1.4; /* è¡Œé–“ã‚’èª¿æ•´ */
        }
    </style>
</head>
<body>

    <h1>ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆç”¨å‹•ç”»</h1>

    <div class="video-container">
        <video id="main-video" src="main.mp4" controls playsinline></video>

        <div class="ad-overlay" id="ad-overlay">
            <video id="ad-video" src="ad.mp4" muted playsinline></video>
            
            <div id="play-button"></div>
            <div id="skip-button">ã‚¹ã‚­ãƒƒãƒ—</div>
            <div id="unmute-button"></div> </div>
    </div>

    <p id="time-display"></p>

    <script>
        // --- 1. è¦ç´ ã®å–å¾— ---
        const mainVideo = document.getElementById('main-video');
        const adOverlay = document.getElementById('ad-overlay');
        const adVideo = document.getElementById('ad-video');
        const playButton = document.getElementById('play-button');
        const skipButton = document.getElementById('skip-button');
        const unmuteButton = document.getElementById('unmute-button');
        const timeDisplay = document.getElementById('time-display');

        // --- 2. è¨­å®šå€¤ ---
        const skippableTime = 5000; // ã‚¹ã‚­ãƒƒãƒ—å¯èƒ½ã«ãªã‚‹ã¾ã§ã®æ™‚é–“ (ãƒŸãƒªç§’)
        let adStartTime; // åºƒå‘Šå†ç”Ÿé–‹å§‹æ™‚åˆ»ã‚’ä¿å­˜ã™ã‚‹å¤‰æ•°

        // --- 3. åˆæœŸåŒ– ---
        mainVideo.pause();

        // ã€Safariå¯¾ç­–ã€‘ãƒŸãƒ¥ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã®åˆæœŸè¡¨ç¤ºã‚’ã€å‹•ç”»ã®å®Ÿéš›ã®ãƒŸãƒ¥ãƒ¼ãƒˆçŠ¶æ…‹ã«åˆã‚ã›ã‚‹
        function updateUnmuteButton() {
            unmuteButton.textContent = adVideo.muted ? 'ğŸ”‡' : 'ğŸ”Š';
        }
        updateUnmuteButton(); // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å®Ÿè¡Œ

        // --- 4. ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š ---

        // (A) å†ç”Ÿãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã‚‰åºƒå‘Šã‚’å†ç”Ÿ
        playButton.addEventListener('click', () => {
            // play()ã¯Promiseã‚’è¿”ã™ãŸã‚ã€æˆåŠŸ/å¤±æ•—ã‚’ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã™ã‚‹ã®ãŒã‚ˆã‚Šä¸å¯§
            adVideo.play().then(() => {
                playButton.style.display = 'none'; // å†ç”Ÿãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤ºã«
                unmuteButton.style.opacity = '1';  // ãƒŸãƒ¥ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
            }).catch(error => {
                console.error("åºƒå‘Šå‹•ç”»ã®å†ç”Ÿã«å¤±æ•—ã—ã¾ã—ãŸ:", error);
                // ã“ã“ã§ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹ãªã©ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ãŒå¯èƒ½
            });
        });

        // (B) åºƒå‘Šã®å†ç”ŸãŒ"å®Ÿéš›ã«"å§‹ã¾ã£ãŸã‚‰ã€æ™‚åˆ»ã‚’è¨˜éŒ²ã—ã‚¹ã‚­ãƒƒãƒ—ãƒœã‚¿ãƒ³è¡¨ç¤ºã‚¿ã‚¤ãƒãƒ¼ã‚’é–‹å§‹
        adVideo.addEventListener('playing', () => {
            adStartTime = Date.now(); // é–‹å§‹æ™‚åˆ»ã‚’è¨˜éŒ²
            
            setTimeout(() => {
                skipButton.style.display = 'block';
            }, skippableTime);
        });

        // (C) ã‚¹ã‚­ãƒƒãƒ—ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã‚‰æ™‚é–“ã‚’è¨ˆæ¸¬ã—ã€æœ¬ç·¨ã¸
        skipButton.addEventListener('click', () => {
            if (adStartTime) {
                const skipTime = Date.now();
                const elapsedTime = (skipTime - adStartTime) / 1000;
                // innerHTMLã¨<br>ã‚’ä½¿ã„ã€ã‚ˆã‚Šç¢ºå®Ÿã«æ”¹è¡Œã•ã›ã‚‹
                timeDisplay.innerHTML = `åºƒå‘Šã¯ ${elapsedTime.toFixed(2)}ç§’ã§ã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã¾ã—ãŸã€‚<br>ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆç”»é¢ã«æˆ»ã£ã¦ãã ã•ã„ã€‚`;
            }
            playMainVideo();
        });
        
        // (D) åºƒå‘ŠãŒæœ€å¾Œã¾ã§å†ç”Ÿã•ã‚ŒãŸã‚‰æœ¬ç·¨ã¸
        adVideo.addEventListener('ended', () => {
            timeDisplay.textContent = 'åºƒå‘ŠãŒæœ€å¾Œã¾ã§å†ç”Ÿã•ã‚Œã¾ã—ãŸã€‚';
            playMainVideo();
        });

        // (E) ãƒŸãƒ¥ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã§éŸ³å£°ã‚ªãƒ³/ã‚ªãƒ•ã‚’åˆ‡ã‚Šæ›¿ãˆ
        unmuteButton.addEventListener('click', () => {
            adVideo.muted = !adVideo.muted; // mutedãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’åè»¢ã•ã›ã‚‹
            updateUnmuteButton(); // ãƒœã‚¿ãƒ³ã®çµµæ–‡å­—ã‚’æ›´æ–°
        });

        // --- 5. ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•° ---

        // æœ¬ç·¨å‹•ç”»ã‚’å†ç”Ÿã™ã‚‹å‡¦ç†
        function playMainVideo() {
            adOverlay.style.display = 'none'; // åºƒå‘Šã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’éè¡¨ç¤º
            adVideo.pause(); 
            adVideo.currentTime = 0; 
            mainVideo.play(); // æœ¬ç·¨ã‚’å†ç”Ÿ
        }
    </script>

</body>
</html>